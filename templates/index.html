<!DOCTYPE html>
<html>
<head>
<title>D√©p√¥t CNAPS</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
        html, body {
            -webkit-text-size-adjust: none !important; /* ‚úÖ bloque le r√©ajustement automatique sur mobile */
        }
        body { font-family: Arial; background: #f5fff5; }
        label, input, textarea, select { display: block; margin: 10px 0; }
        #message {
            font-weight: bold;
            color: green;
            margin-top: 20px;
        }
        .conformite-box {
            border: 2px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            background: #f9fff9;
        }
        .conformite-box h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        .conformite-box label {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 10px 0;
            font-size: 16px !important;
            font-weight: normal !important;
            line-height: 1.5;
            color: #000;
        }
        .conformite-box input[type="checkbox"] {
            margin-top: 4px;
            flex-shrink: 0;
            transform: scale(1.2);
        }
</style>
<script>
        function toggleHeberge() {
            var section = document.getElementById("heberge_section");
            section.style.display = document.getElementById("heberge").checked ? "block" : "none";
        }

        function toggleNonFrancais() {
            var section = document.getElementById("non_francais_section");
            var casierInput = document.getElementById("non_francais_casier");
            var diplomeInput = document.getElementById("non_francais_diplome");
            var checked = document.getElementById("non_francais").checked;

            section.style.display = checked ? "block" : "none";
            casierInput.required = checked;
            diplomeInput.required = checked;
        }

        window.addEventListener("DOMContentLoaded", () => {
            const form = document.querySelector("form");
            form.addEventListener("submit", function (e) {
                const checks = document.querySelectorAll(".check-conformite");
                let allChecked = true;
                checks.forEach(chk => {
                    if (!chk.checked) allChecked = false;
                });
                if (!allChecked) {
                    e.preventDefault();
                    alert("‚ö†Ô∏è Vous devez cocher toutes les cases de conformit√© avant de valider le formulaire.");
                }
            });
        });
</script>
</head>
<body>
<div style="max-width: 700px; margin: 40px auto; text-align: center; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 0 15px rgba(0,0,0,0.05);">
    <img alt="Logo Int√©grale Academy" src="/static/logo_integrale_academy.png" style="height: 150px; display: block; margin: 0 auto 20px auto;"/>
    <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8em;">Formulaire de d√©p√¥t CNAPS</h2>

    <form action="/submit" enctype="multipart/form-data" method="POST" style="text-align: left; margin-top: 20px;">
        <label>Nom :</label><input name="nom" required type="text"/>
        <label>Pr√©nom :</label><input name="prenom" required type="text"/>
        <label>Email :</label><input name="email" required type="email"/>
        
        <label>1 - Carte d'identit√© RECTO ET VERSO / Passeport / Titre de s√©jour :</label>
        <div id="id-files-container">
            <input multiple name="id_files" required type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt"/>
            <button id="add-id-file" style="margin-top: 10px; display: block;" type="button">+ Ajouter un autre fichier</button>
        </div>

        <label>2 - Justificatif de domicile DE MOINS DE 3 MOIS :</label>
        <strong>ATTENTION : Bien v√©rifier que le justificatif de domicile a moins de 3 mois. Uniquement facture de gaz, d'√©lectricit√©, d'eau ou quittance de loyer (PAS de facture de t√©l√©phone)</strong>
        <input name="domicile_file" required type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt"/>

        <label style="margin-top: 20px; font-weight: bold; font-size: 1.1em;">
            3 - Si vous √™tes h√©berg√©(e), cochez la case 
            <input id="heberge" onchange="toggleHeberge()" type="checkbox"/>
        </label>
        <div id="heberge_section" style="display: none;">
            <label>Pi√®ce d'identit√© de l'h√©bergeant - ATTENTION : RECTO ET VERSO :</label>
            <div id="hebergeant-files-container">
                <input name="identite_hebergeant" type="file" accept=".pdf,.jpg,.jpeg,.png"/>
                <button id="add-hebergeant-file" style="margin-top: 10px; display: block;" type="button">+ Ajouter un autre fichier</button>
            </div>
            <label>Attestation d'h√©bergement SIGNEE :</label>
            <input name="attestation_hebergement" type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt"/>
        </div>

        <label style="margin-top: 20px; font-weight: bold; font-size: 1.1em;">
            4 - Si vous n'avez pas la nationalit√© fran√ßaise, cochez la case
            <input id="non_francais" onchange="toggleNonFrancais()" type="checkbox"/>
        </label>
        <div id="non_francais_section" style="display: none;">
            <label>Casier judiciaire de moins de 3 mois du PAYS DE NAISSANCE traduit en fran√ßais par un traducteur asserment√© :</label>
            <input id="non_francais_casier" name="non_francais_casier" type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt"/>
            <label>Dipl√¥me fran√ßais sup√©rieur au bac ou Attestation de r√©ussite au test TCF (niveau B1 minimum) :</label>
            <input id="non_francais_diplome" name="non_francais_diplome" type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt"/>
        </div>

        <!-- Nouvelle section Contr√¥le de conformit√© -->
        <div class="conformite-box">
            <h3>üîç Contr√¥le de conformit√©</h3>
            <label><input type="checkbox" class="check-conformite"/> J'ai bien fourni ma carte d'identit√© RECTO et VERSO (face avant, face arri√®re) ou mon passeport.</label>
            <label><input type="checkbox" class="check-conformite"/> Les documents que j'ai fourni sont bien LISIBLES et ne sont pas flous.</label>
            <label><input type="checkbox" class="check-conformite"/> Mon justificatif de domicile a bien MOINS DE 3 MOIS.</label>
            <label><input type="checkbox" class="check-conformite"/> Mon justificatif de domicile N'EST PAS UNE FACTURE DE T√âL√âPHONE.</label>
            <label><input type="checkbox" class="check-conformite"/> Si je suis h√©berg√©, j'ai bien fourni la pi√®ce d'identit√© de mon h√©bergeant RECTO et VERSO (face avant, face arri√®re).</label>
            <label><input type="checkbox" class="check-conformite"/> Si je suis h√©berg√©, j'ai v√©rifi√© que l'attestation d'h√©bergement est bien sign√©e.</label>
        </div>

        <button type="submit">Envoyer</button>
    </form>
</div>

<!-- ‚úÖ Validation fichiers vides -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");

  form.addEventListener("submit", function (e) {
    let invalid = false;
    const fileInputs = form.querySelectorAll('input[type="file"]');

    fileInputs.forEach(input => {
      for (let i = 0; i < input.files.length; i++) {
        const f = input.files[i];
        if (!f || f.size === 0) {
          invalid = true;
        }
      }
    });

    if (invalid) {
      e.preventDefault();
      alert("‚ö†Ô∏è Le fichier choisi est vide ou inaccessible.\n\nMerci de v√©rifier que :\n- Le fichier est bien enregistr√© sur votre appareil\n- Vous ne l‚Äôenvoyez pas directement depuis WhatsApp, Drive ou iCloud\n- Vous s√©lectionnez un vrai fichier local (PDF, JPG, PNG...).");
    }
  });
});
</script>

<!-- ‚úÖ Bouton + fichier identit√© -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const addButton = document.getElementById("add-id-file");
  const container = document.getElementById("id-files-container");
  addButton.addEventListener("click", function () {
    const newInput = document.createElement("input");
    newInput.type = "file";
    newInput.name = "id_files";
    newInput.required = true;
    newInput.accept = ".pdf,.jpg,.jpeg,.png,.doc,.docx,.rtf,.odt";
    container.insertBefore(newInput, addButton);
  });
});
</script>

<!-- ‚úÖ Bouton + fichier h√©bergeant -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const addHebergeant = document.getElementById("add-hebergeant-file");
  const containerHebergeant = document.getElementById("hebergeant-files-container");
  addHebergeant.addEventListener("click", function () {
    const newInput = document.createElement("input");
    newInput.type = "file";
    newInput.name = "identite_hebergeant";
    newInput.accept = ".pdf,.jpg,.jpeg,.png";
    containerHebergeant.insertBefore(newInput, addHebergeant);
  });
});
</script>
</body>
</html>
